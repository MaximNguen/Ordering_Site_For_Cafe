{% extends "base.html" %}
{% load static %}

{% block content %}
<main class="main-section">
    <section class="menu-section">
        <div class="menu-section-word">
            <p><b>Оформление заказа</b></p>
        </div>
    </section>

    <section class="order-form-section">
        <div class="order-summary">
            <h3>Ваш заказ</h3>
            <ul>
                {% for item in cart_items %}
                <li>{{ item.quantity }} x {{ item.product.name }} - {{ item.total_price }}₽</li>
                {% endfor %}
            </ul>
            <p><strong>Итого: {{ total }}₽</strong></p>
        </div>

        <form method="post" class="order-form" id="order-form">
            {% csrf_token %}
            {{ form.as_p }}
            <p>Информируем вас, что при выборе доставки, <br>к заказу будет добавлена 150₽ за услугу доставки</p>
            <button type="submit" class="submit-order" id="submit-button">Подтвердить заказ</button>
        </form>
    </section>
</main>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const deliveryMethod = document.getElementById('id_delivery_method');
    const addressInput = document.getElementById('id_delivery_address');
    const pickupSelect = document.getElementById('id_pickup_location');
    const hiddenAddress = document.querySelector('[name="hidden_delivery_address"]');

    if (!deliveryMethod || !addressInput || !pickupSelect) return;

    const addressWrapper = addressInput.closest('p');
    const pickupWrapper = pickupSelect.closest('p');

    function updateFormFields() {
        const isPickup = deliveryMethod.value === 'pickup';

        if (isPickup) {
            // Скрываем поле адреса доставки, показываем выбор точки самовывоза
            if (addressWrapper) addressWrapper.style.display = 'none';
            if (pickupWrapper) pickupWrapper.style.display = 'block';

            // Устанавливаем адрес из выбранной точки в скрытое поле
            if (pickupSelect.value) {
                const selectedOption = pickupSelect.options[pickupSelect.selectedIndex];
                hiddenAddress.value = selectedOption.text;
            }
        } else {
            // Показываем поле адреса доставки, скрываем выбор точки самовывоза
            if (addressWrapper) addressWrapper.style.display = 'block';
            if (pickupWrapper) pickupWrapper.style.display = 'none';
        }
    }

    // Инициализация при загрузке
    updateFormFields();

    // Обработчики событий
    deliveryMethod.addEventListener('change', updateFormFields);
    pickupSelect.addEventListener('change', function() {
        if (deliveryMethod.value === 'pickup' && pickupSelect.value) {
            const selectedOption = pickupSelect.options[pickupSelect.selectedIndex];
            hiddenAddress.value = selectedOption.text;
        }
    });
});
</script>
</script>
{% endblock %}